<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Password Reset</title>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <style>
        .container {
            width: 50%;
            margin: auto;
            padding: 20px;
        }

        .modal-header {
            background-color: #f2f2f2;
            padding: 15px;
            text-align: center;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            background-color: #f2f2f2;
            padding: 15px;
            text-align: center;
        }

        #checkMsg {
            margin-top: 10px;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Modal -->
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Password Reset</h4>
                </div>
                <div class="modal-body">
                    <div>Please enter your registered email and username.</div>
                    <hr>
                    <form id="findPwForm">
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="text" class="form-control" id="email" placeholder="Enter your registered email">
                        </div>
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input type="text" class="form-control" id="username" placeholder="Enter your registered username">
                        </div>
                        <button type="button" class="btn btn-success btn-block" id="checkEmail">Submit</button>
                    </form>
                    <div class="text-center small mt-2" id="checkMsg"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger btn-default pull-left" data-dismiss="modal">Cancel</button>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    $('.modal').on('hidden.bs.modal', function (e) {
        console.log('modal close');
        $(this).find('form')[0].reset();
    });

    $("#checkEmail").click(function () {
        let email = $("#email").val();
        let username = $("#username").val();

        $.ajax({
            type: "GET",
            url: "/check/findPw",
            data: {
                "email": email,
                "username": username
            },
            success: function (res) {
                if (res.check) {
                     alert("Success", "An email with temporary password has been sent to your email.", "success").then((OK) => {
                        if (OK) {
                            $.ajax({
                                type: "POST",
                                url: "/check/findPw/sendEmail",
                                data: {
                                    "email": email,
                                    "username": username
                                },
                                success: function () {
                                    window.location = "/login";
                                }
                            });
                        }
                    });
                    $('#checkMsg').html('');
                } else {
                    $('#checkMsg').html('<p style="color:red">Invalid email or username.</p>');
                }
            }
        });
    });



<!--     function sendEmailForPw() {-->
<!--    // 이메일 주소 가져오기-->
<!--    var email = $("#email").val();-->
<!--    var username = $("#username").val();-->

<!--    // AJAX 요청 보내기-->
<!--    $.ajax({-->
<!--        url: "/check/findPw", // 이메일 인증번호를 보낼 서버의 URL-->
<!--        method: "POST",-->
<!--        data: {email: email, username: username}, // 이메일 주소를 서버로 전달-->
<!--        success: function(response) {-->
<!--            alert("임시 비밀번호 발송 성공.");-->
<!--        },-->
<!--        error: function(xhr, status, error) {-->
<!--            alert("임시 비밀번호 발송 실패.");-->
<!--        }-->
<!--    });-->
</script>
</body>
</html>